    {% load staticfiles %}
	
	<script type="text/javascript">
	
	function errorTest()
	{
		if ({{BadSearch}}) {
			resetAll();
		} else if ({{Error}}) {
			alert("Something went wrong!");
			resetAll();
		} else if ({{NoGames}}) {
			alert("No games matched your search. Consider removing some limited factors.");
			resetAll();			
		}
	}
	
	<!-- Pie Chart Code -->	
	google.charts.load('current', {'packages':['corechart']});
	<!-- google.charts.setOnLoadCallback(drawChart); -->
		
	function drawChart(data) 
	{
		var chart = new google.visualization.PieChart(document.getElementById('piechart'));
		
		var options = {
		  title: 'Round Results',
		  backgroundColor: '#f6f6f6',
		  chartArea:{width:'100%',height:'100%'},
		  colors:['#2554C7','#002295','#00004F','#C79926','#947100']
		};

		chart.draw(data, options);
	}
	
	
	//TODO: Fix this!
	function insertIcon(selectedIcon) 
	{
		// myImage : ID of image on which to place new image
		var image = document.getElementById("maplistener");

		console.log(image.width);

		margin = 20;

		l = image.offsetLeft;
		t = image.offsetTop;
		w = image.width;
		h = image.height;

		// Location inside the image
		offX = parseInt(Math.random() * w);
		offY = parseInt(Math.random() * h);

		if(offX > margin) offX -= margin;
		if(offY > margin) offY -= margin;

		l += offX;
		t += offY;

		var newImage = document.createElement("img");
		newImage.setAttribute('src', '1.jpg');
		newImage.setAttribute('class', 'overlays');
		newImage.style.left = l + "px";
		newImage.style.top = t + "px";
		document.body.appendChild(newImage);
	}
	
	
	function setObjectPosition(positionID, selectedObject)
	{
		if (selectedObject == "nade")
		{
			nadetype = document.getElementById("nadetype").value
			switch (nadetype) 
			{
				case "bombdown" :
				case "bombplanted" :
				<!-- Too many bombs is handled by setActive, so setting a bomb can't be done. Could probably be hacked but it will just give zero results in the query.-->
					BOMBCOUNT = BOMBCOUNT + 1;
					moveIcon(nadetype);
					nadetype = nadetype.replace("bombdown", "Bomb Down").replace("bombplanted", "Bomb Planted")
					break;
					
				case "Smoke" :
					SMOKECOUNT = SMOKECOUNT + 1;
					if (SMOKECOUNT > 10){alert("More than 10 Smokes?");}
					cursorX = cursorX - 7
					cursorY = cursorY - 7
					moveIcon(nadetype + SMOKECOUNT);
					break;
				
				case "Flash" : 
					FLASHCOUNT = FLASHCOUNT + 1;
					if (FLASHCOUNT > 20){alert("More than 20 Flashes?");}
					cursorX = cursorX - 7
					cursorY = cursorY - 7
					moveIcon(nadetype + FLASHCOUNT);
					break;
				
				case "HE" : 
					HECOUNT = HECOUNT + 1;
					if (HECOUNT > 10){alert("More than 10 HEs?");}
					cursorX = cursorX - 3
					cursorY = cursorY - 3
					moveIcon(nadetype + HECOUNT);
					break;
				
				case "Molly" : 
					MOLLYCOUNT = MOLLYCOUNT + 1;
					if (MOLLYCOUNT > 10){alert("More than 10 mollies?");}
					cursorX = cursorX - 5
					cursorY = cursorY - 10
					moveIcon(nadetype + MOLLYCOUNT);
					break;
				
				case "Decoy" : 
					DECOYCOUNT = DECOYCOUNT + 1;
					if (DECOYCOUNT > 10){alert("More than 10 Decoys? Bold strategy.");}
					moveIcon(nadetype + DECOYCOUNT);
					break;
					
				default :
					alert("You snuck a weird nade in!");
					break;
			}
			
			<!-- Add nade to list -->
			OBJECT = "null";
			NADES.push(nadetype + " " + positionID + " - " + document.getElementById("nadeprecision").value);
			nadesbox.value=NADES.join("\n");
			
		} else if (selectedObject == "T") {
			<!-- Add T to list -->
			OBJECT = "null";
			PLAYERS.push("T - " + document.getElementById("weapon").value + " - " + positionID);
			playerbox.value=PLAYERS.join("\n");
			
		} else if (selectedObject == "CT") {
			<!-- Add CT to list -->
			OBJECT = "null";
			PLAYERS.push("CT - " + document.getElementById("weapon").value + " - " + positionID);
			playerbox.value=PLAYERS.join("\n");
			
		} else {
			alert("Please select the object first!");
		}
	}
	
	
	function moveIcon(selectedIcon)
	{
	    var avatar = document.getElementById(selectedIcon);
		avatar.style.left = cursorX + "px";
		avatar.style.top = cursorY + "px";	
	}
	
	function setActive(newObject)
	{
		if (newObject == 'nade' && BOMBCOUNT == 1 && (document.getElementById("nadetype").value == "bombdown" || document.getElementById("nadetype").value == "bombplanted")) 
		{
			document.getElementById("nadetype").value = "Smoke"
			alert("You already have a bomb somewhere!");
		} else if (selectedObject == "T" && TCount > 5) {
			alert("Too many Ts!");
		} else if (selectedObject == "CT" && CTCount > 5) {
			alert("Too many CTs!");
		} else {
			OBJECT = newObject;
		}
	}
	
	function setDead(player)
	{
		if (player == "T" && TCount > 5) {
			alert("Too many Ts!");
		} else if (player == "CT" && CTCount > 5) {
			alert("Too many CTs!");
		} else {
			OBJECT = "null";
			PLAYERS.push(player + " - Dead - Still dead");
			playerbox.value=PLAYERS.join("\n");
		}
	}
	
	function clearPlayers()
	{
		PLAYERS.length = 0;
		playerbox.value=PLAYERS.join("");
		TCount = 0;
		CTCount = 0;
	}
	
	function clearNades()
	{
		NADES.length = 0;
		<!-- check if this can be just NADES not NADES.join() -->
		nadesbox.value=NADES.join("\n");
		SMOKECOUNT = 0;
		FLASHCOUNT = 0;
		HECOUNT = 0;
		MOLLYCOUNT = 0;
		DECOYCOUNT = 0;
		BOMBCOUNT = 0;
		resetNadeIcons();
	}
	
	//Consider refactoring to more accurate "deleteIcon"
	function resetIcon(icon)
	{
		var icon = document.getElementById(selectedIcon);
		icon.parentNode.removeChild(icon);
	}
	
	function resetAllIcons()
	{
		for (i = 1; i <=5; i++)
		{
		resetIcon("CT"+i);
		resetIcon("T"+i);
		}
		resetNadeIcons();
	}
	
	function resetNadeIcons()
	{
		for (i = 1; i <=10; i++)
		{
			resetIcon("Smoke" + i);
			resetIcon("Flash" + i);
			<!-- Allows for up to 20 flashes -->
			resetIcon("Flash" + (i + 10)); 
			resetIcon("HE" + i);
			resetIcon("Molly" + i);
			resetIcon("Decoy" + i);
		}
		resetIcon("bombdown");
		resetIcon("bombplanted");
	}
	
	function resetAll()
	{
		clearNades();
		clearPlayers();
		OBJECT = "null";			
		drawResults();
	}
	
	
	function drawResults()
	{
		var data = google.visualization.arrayToDataTable([
          ['Winner', 'Percent'],
          ['CTKills', {{CTKill}}],
          ['Defuse', {{Defuse}}],
          ['Time',  {{Time}}],
          ['TKills', {{TKill}}],
          ['Target Bombed', {{TargetBombed}}],
        ]);	
		
		drawChart(data);
	}
	
	

</script>